<jsp:root
    version="2.0"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:x="http://java.sun.com/jsp/jstl/xml"
    xmlns:os="http://www.opensymphony.com/oscache"
    xmlns:mm="http://www.mmbase.org/mmbase-taglib-2.0"
    xmlns:mmweb="urn:jsptagdir:/WEB-INF/tags/mmweb">
  <mmweb:html styleClass="articles">
    <jsp:attribute name="head">
    
    </jsp:attribute>
    <jsp:attribute name="body">
      <mm:import id="page" externid="n" />
      
      <mmweb:submenu page="${page}" />
      
      <mm:node referid="page">
        <div id="content">
          <div>
            <mm:relatednodescontainer type="articles" role="posrel" searchdirs="destination">
              <mm:sortorder field="posrel.pos" direction="UP" />
              <mm:maxnumber value="1" />
              <mm:relatednodes>
                
                <h2><mm:field name="title" id="pagetitle" /></h2>
                <mm:field name="subtitle"><mm:isnotempty><h3><mm:write /></h3></mm:isnotempty></mm:field>
                <p class="intro">
                  <mm:field name="online"><mm:isnotempty><mm:time format=":LONG" /></mm:isnotempty></mm:field>
                  <mm:field name="intro"><mm:isnotempty><mm:write escape="links" /></mm:isnotempty></mm:field>
                </p>
                
                <!-- images -->
                <mm:relatednodescontainer type="images" role="posrel" searchdirs="destination">
                  <mm:sortorder field="posrel.pos" direction="UP" />
                  <mm:relatednodes>
                    <div class="images">
                      <mm:import id="lightbox_image" reset="true"><mm:image template="s(600)" /></mm:import>
                      <a class="lightbox" title="${_node.title}" href="${lightbox_image}">
                        <mm:image template="s(240)" mode="img" />
                      </a>
                      <mm:field name="title"><mm:isnotempty><mm:write /></mm:isnotempty></mm:field>
                    </div>
                  </mm:relatednodes>
                </mm:relatednodescontainer>
                
                <!-- urls and files -->
                <mm:relatednodescontainer type="urls" role="posrel" searchdirs="destination">
                  <mm:size id="nr_urls" write="false" />
                </mm:relatednodescontainer>
                <mm:relatednodescontainer type="attachments" role="posrel" searchdirs="destination">
                  <mm:size id="nr_files" write="false" />
                </mm:relatednodescontainer>
                
                <c:if test="${nr_urls gt 0 or nr_files gt 0}">
                  <div class="related">
                    
                    <mm:relatednodescontainer type="urls" role="posrel" searchdirs="destination">
                      <mm:sortorder field="posrel.pos" direction="UP" />
                      <ul class="urls">
                        <mm:relatednodes>
                          <li>
                            <a title="${_node.description}" href="${_node.url}"><mm:field name="name" /></a>
                          </li>
                        </mm:relatednodes>
                      </ul>
                    </mm:relatednodescontainer>

                    <mm:relatednodescontainer type="attachments" role="posrel" searchdirs="destination">
                      <mm:sortorder field="posrel.pos" direction="UP" />
                      <ul class="attachments">
                        <mm:relatednodes>
                          <li>
                            <mm:attachment><a title="${_node.description}" href="${_}"><mm:field name="title" /></a></mm:attachment>
                            (<mm:field name="mimetype" />, <mm:field name="size" escape="filesize" />)
                          </li>
                        </mm:relatednodes>
                      </ul>
                    </mm:relatednodescontainer>

                  </div>
                </c:if>

                <mm:field name="body" escape="paragraph,links" />
              
              </mm:relatednodes>
            </mm:relatednodescontainer>
  
            <mm:relatednodescontainer type="articles" role="posrel" searchdirs="destination">
              <mm:sortorder field="posrel.pos" direction="DOWN" />
              <mm:offset value="1" />
              <mm:relatednodes>
                <h2><mm:field name="title" /></h2>
                <mm:field name="intro" escape="paragraph(intro),links" />
                <mm:field name="body" escape="paragraph,links" />
              </mm:relatednodes>
            </mm:relatednodescontainer>
          </div>
        </div>
      
        <div id="sidebar">
          <div>
            page: ${page}
            <mm:nodefunction name="parent" referids="_node@node" set="mmsite">
              <mm:import id="parent" reset="true"><mm:field name="number" /></mm:import>
            </mm:nodefunction>
            parent: ${parent}
           <mm:nodefunction name="root" referids="_node@node" set="mmsite">
              <mm:import id="root" reset="true"><mm:field name="number" /></mm:import>
           </mm:nodefunction>
            root: ${root}
           <mm:nodelistfunction name="crumbs" referids="_node@node" set="mmsite">
             crumbs: ${_node.number}
           </mm:nodelistfunction>
          
            <mm:relatednodescontainer type="pages" role="posrel" searchdirs="destination">
              <h4>Read more</h4>
              <ul class="nolist">
              <mm:relatednodes>
                <li>
                  <mm:link page="page" referids="_node@n">
                    <mm:frameworkparam name="component">mmsite</mm:frameworkparam>
                    <a href="${_}"><mm:field name="title" /></a>
                  </mm:link>
                </li>
              </mm:relatednodes>
              </ul>
            </mm:relatednodescontainer>
            
  
          </div>
        </div>
      </mm:node>
    </jsp:attribute>
    <jsp:attribute name="title">${pagetitle}</jsp:attribute>
  </mmweb:html>
</jsp:root>
